<?xml version="1.0" encoding="UTF-8"?>
<METASCHEMA xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0">
    <schema-name>Computer Model</schema-name>
    <schema-version>0.0.5</schema-version>
    <short-name>computer</short-name>
    <namespace>http://example.com/ns/computer</namespace>
    <json-base-uri>http://example.com/ns/computer</json-base-uri>
    <define-assembly name="vendor">
        <formal-name>Vendor Information</formal-name>
        <description>Information about a vendor of a computer part.</description>
       <define-flag name="id" as-type="string" required="yes">
          <formal-name>Vendor Identifier</formal-name>
          <description>An identifier for classifying a unique computer parts vendor.</description>
       </define-flag>
       <model>
            <define-field name="name" min-occurs="1" max-occurs="1">
                <formal-name>Vendor Name</formal-name>
                <description>The registered company name of the vendor.</description>
            </define-field>
            <define-field name="address" min-occurs="1" max-occurs="1">
                <formal-name>Vendor Address</formal-name>
                <description>The physical address of an office location for the vendor.</description>
            </define-field>
            <define-field name="website" as-type="uri" min-occurs="1" max-occurs="1">
                <formal-name>Vendor Website</formal-name>
                <description>A public website made by the vendor documenting their parts as used in the computer.</description>
            </define-field>
        </model>
    </define-assembly>
   <define-flag name="date-of-manufacture" as-type="string">
      <formal-name>Date of manufacture</formal-name>
      <description>When the computer was manufactured.</description>
      
   </define-flag>
    <define-field name="product-name" as-type="string">
        <formal-name>Product Name</formal-name>
        <description>The product name from the vendor of the computer part.</description>
    </define-field>
    <define-assembly name="computer">
        <formal-name>Computer Assembly</formal-name>
        <description>A container object for a computer, its parts, and its sub-parts.</description>
        <root-name>computer</root-name>
       <flag ref="date-of-manufacture" required="no"/>
       
       <define-flag name="id" as-type="string" required="yes">
            <formal-name>Computer Identifier</formal-name>
            <description>An identifier for classifying a unique make and model of computer.</description>
            <constraint>
               <matches regex="\i\c*" id="id-naming-rule_1">
                  <remarks>
                     <p>Must match pattern for XML name.</p>
                  </remarks>
               </matches>
            </constraint>
        </define-flag>
       
        <model>
            <define-assembly name="motherboard">
                <formal-name>Motherboard Assembly</formal-name>
                <description>A container object for a motherboard in a computer and its sub-parts.</description>
                <model>
                    <assembly ref="vendor"/>
                    <define-field name="type" as-type="string" min-occurs="1" max-occurs="1">
                        <formal-name>Motherboard Type</formal-name>
                        <description>The type motherboard layout, <code>at</code>, <code>atx</code>, <code>mini-itx</code> or an alternative.</description>
                       <constraint>
                          <allowed-values target="." id="motherboard-type-rule_1">
                             <enum value="at">AT</enum>
                             <enum value="atx">ATX</enum>
                             <enum value="mini-itx">Mini-ITX</enum>
                             <enum value="custom">Custom</enum>
                          </allowed-values>
                       </constraint>
                    </define-field>
                    <define-assembly name="cpu">
                        <formal-name>Motherboard Central Processing Unit (CPU)</formal-name>
                        <description>The model number of the CPU on the motherboard of a computer.</description>
                        <model>
                            <assembly ref="vendor"/>
                            <field ref="product-name" min-occurs="1" max-occurs="1"/>
                            <define-field name="architecture" as-type="string" min-occurs="1" max-occurs="1">
                                <formal-name>CPU Architecture</formal-name>
                                <description>The Instruction Set Architecture (ISA) of the processor, <code>x86</code>, <code>x86-64</code>, <code>arm</code>, or an alternative.</description>
                            </define-field>
                            <define-field name="speed" as-type="string" min-occurs="1" max-occurs="1">
                                <formal-name>CPU Speed</formal-name>
                                <description>The clock speed of the CPU in megahertz or gigahertz.</description>
                               <constraint>
                                  <matches target="." regex="\d+(\.\d+)?(M|G)Hz" id="cpu-speed-rule_1"/>
                               </constraint>
                            </define-field>
                        </model>
                       
                    </define-assembly>
                    <define-assembly name="ata-socket">
                        <formal-name>Motherboard Advanced Technology Attachment (ATA) Socket</formal-name>
                        <description>The model number of ATA socket on the motherboard of a computer. There will only be one socket on any motherboard.</description>
                        <model>
                            <assembly ref="vendor"/>        
                            <field ref="product-name" min-occurs="1" max-occurs="1"/>
                            <define-field name="type" as-type="string" min-occurs="1" max-occurs="1">
                                <formal-name>ATA Socket Type</formal-name>
                                <description>The type of ATA socket on the motherboard , <code>pata</code> (parallel ATA), <code>sata</code> (Serial ATA), or an alternative.</description>
                            </define-field>
                        </model>
                       <constraint>
                          <allowed-values target="child::product-name" id="ata-socket-rule_1">
                             <enum value="Socketeer I">Socketeer I</enum>
                             <enum value="Socketeer II">Socketeer II</enum>
                             <enum value="LampSocket socket">LampSocket socket</enum>
                             <enum value="MiniSock Deux">MiniSock Deux</enum>
                             <enum value="SprocketSocket">SprocketSocket 1000</enum>
                             <enum value="[Unlisted Socket Product]">Unlisted</enum>
                          </allowed-values>
                          <allowed-values target="child::vendor/child::name" id="ata-socket-rule_2">
                             <enum value="Socketeer">Socketeer</enum>
                             <enum value="LampSocket">LampSocket</enum>
                             <enum value="MiniSock">MiniSock</enum>
                             <enum value="SprocketSocket">SprocketSocket</enum>
                             <enum value="[Unlisted Socket Vendor]">Unlisted</enum>
                          </allowed-values>
                          <allowed-values target="self::*[vendor/name='Socketeer']/product-name"  id="ata-socket-rule_3"><!-- here we have a co-occurrence constraint -->
                             <enum value="Socketeer I">Socketeer I</enum>
                             <enum value="Socketeer II">Socketeer II</enum>
                          </allowed-values>
                       </constraint>
                    </define-assembly>
                    <define-assembly name="memory" min-occurs="1" max-occurs="unbounded">
                        <formal-name>Motherboard Random Access Memory (RAM) Module(s)</formal-name>
                        <description>Random access memory hardware installed on the motherboard of a computer.</description>
                        <group-as name="memory-modules" in-json="ARRAY"/>
                        <model>
                            <assembly ref="vendor"/>
                            <field ref="product-name" min-occurs="1" max-occurs="1"/>
                            <define-field name="byte-size" as-type="positive-integer" min-occurs="1" max-occurs="1">
                                <formal-name>Memory Module Size</formal-name>
                                <description>Size of the memory module in binary, not SI base-10 units, meaning a kilobyte is 1024 bytes, not 1000 bytes.</description>
                            </define-field>
                        </model>
                       <constraint>
                          <expect target="." test="not(@byte-size != ../@byte-size" id="memory-rule-1"><!-- All memory must all have the same byte-size--></expect>
                       </constraint>
                    </define-assembly>
                    <assembly ref="cooling" min-occurs="0"/>
                    <define-assembly name="expansion-card" min-occurs="0" max-occurs="unbounded">
                        <formal-name>Motherboard Expansion Card</formal-name>
                        <description>The model number of an expansion card connected to the motherboard of a computer.</description>
                        <group-as name="expansion-cards" in-json="ARRAY"/>
                       <define-flag name="state">
                          <formal-name>Card state</formal-name>
                          <description>If tested or prepackaged, the state of an expansion card may be known.</description>
                          <constraint>
                             <allowed-values id="expansion-card-state-rule_1">
                                <enum value="new">New</enum>
                                <enum value="refurb">Refurb</enum>
                                <enum value="inoperative">Inoperative</enum>
                             </allowed-values>
                             <matches id="expansion-card-state-rule_3" datatype="uri"/>
                             
                          </constraint>
                       </define-flag>
                        <model>
                            <assembly ref="vendor"/>
                            <field ref="product-name" min-occurs="1" max-occurs="1"/>
                            <define-field name="type" as-type="string" min-occurs="1" max-occurs="1">
                                <formal-name>Expansion Card Type</formal-name>
                               <description>The type of expansion card on a motherboard of a computer, such as <code>pci</code> (PCI, e.g. Peripheral Component Interconnect), <code>pcie</code> (PCI Express), or an alternative.</description>
                            </define-field>
                        </model>
                    </define-assembly>
                </model>
            </define-assembly>
        </model>
       <constraint>
          <allowed-values allow-other="yes" id="manufacture-date-rule_1" target="self::*[starts-with(@id,'A')]/@date-of-manufacture">
             <enum value="1960-11-20">Nov 20 1960</enum>
             <enum value="1962-06-28">Jun 28 1962</enum>
             <enum value="1963-11-04">Nov 4 1963</enum>
          </allowed-values>
          <expect  id="manufacture-date-rule_2" target="@date-of-manufacture" test="xs:date(.) gt xs:date('1950-01-01')"/>
          <matches  id="manufacture-date-rule_3" target="@date-of-manufacture" datatype="date" level="WARNING" />
       </constraint>
    </define-assembly>
    
    <define-assembly name="cooling">
        <formal-name>Cooling</formal-name>
        <description>How the computer cools itself.</description>
        <model>
            <choice><!-- modeled as a choice here: multiple fans, or water. -->
                <define-assembly name="fan" min-occurs="2" max-occurs="12">
                    <formal-name>Fan</formal-name>
                   <description>A fan header for a single fan; at least two fans are required for adequate cooling.</description>                   
                </define-assembly>
                <define-assembly name="water" min-occurs="1" max-occurs="1">
                    <formal-name>Water</formal-name>
                    <description>A cooling system using water for thermal regulation.</description>                    
                    <define-flag name="illuminated" as-type="boolean">
                        <formal-name>Whether illuminated</formal-name>
                        <description>The water system is illuminated for visual effect.</description>
                    </define-flag>
                </define-assembly>
            </choice>
        </model>
    </define-assembly>
</METASCHEMA>